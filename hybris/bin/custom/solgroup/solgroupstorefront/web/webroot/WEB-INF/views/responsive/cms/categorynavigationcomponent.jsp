<%@ page trimDirectiveWhitespaces="true"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="cms" uri="http://hybris.com/tld/cmstags"%>

<c:if test="${component.visible}">
	<nav class="navigation navigation--bottom js_navigation--bottom js-enquire-offcanvas-navigation" role="navigation">
		<ul class="sticky-nav-top hidden-lg hidden-md js-sticky-user-group hidden-md hidden-lg">
                <%--Dynamically generated by 'acc.navigation.js"--%>
        </ul>
		<div class="navigation__overflow">
			<ul data-trigger="#signedInUserOptionsToggle" class="nav__links nav__links--products nav__links--mobile js-userAccount-Links js-nav-collapse-body offcanvasGroup1 collapse in hidden-md hidden-lg">
                   <%--Dynamically generated by 'acc.navigation.js"--%>
           	</ul>

		
		<%--Top bar navigation --%>
		<ul class="sf-menu nav__links nav__links--products">
		
			<%-- Iterate over all navigation nodes 1 level --%>
			<c:forEach items="${component.navigationNode.children}" var="childLevel1"> 
				
				
				<li class="auto nav__links--primary <c:if test="${not empty childLevel1.children}">nav__links--primary-has__sub</c:if>">
				
					
				
					<c:forEach items="${childLevel1.entries}" var="childlink1">
						<cms:component component="${childlink1.item}" evaluateRestriction="true" element="span" class="nav__link js_nav__link" />
					</c:forEach>
					
					<%-- Calculate how many sub columns are needed -- Start --%>
					<c:set var="totalSubNavigationColumns" value="${0}"/>
					<c:set var="hasSubChild" value="false"/>
					<c:forEach items="${childLevel1.children}" var="childLevel2"> 
						<c:if test="${not empty childLevel2.children}">
							<c:set var="hasSubChild" value="true"/>
							<c:set var="subSectionColumns" value="${fn:length(childLevel2.children)/component.wrapAfter}"/>
							<c:if test="${subSectionColumns > 1 && fn:length(childLevel2.children)%component.wrapAfter > 0}">
								<c:set var="subSectionColumns" value="${subSectionColumns + 1}"/>
							</c:if>
							<c:choose>
								<c:when test="${subSectionColumns > 1}">
									<c:set var="totalSubNavigationColumns" value="${totalSubNavigationColumns + subSectionColumns}" />
								</c:when>
		
								<c:when test="${subSectionColumns < 1}">
									<c:set var="totalSubNavigationColumns" value="${totalSubNavigationColumns + 1}" />
								</c:when>
							</c:choose>
						</c:if>
					</c:forEach>
					<%-- Calculate how many sub columns are needed -- End --%>
					
					<%-- Decide which class to use -- Start --%>
					<c:choose>
						<c:when test="${!hasSubChild || (totalSubNavigationColumns > 0 && totalSubNavigationColumns <= 1)}">
							<c:set value="col-md-3 col-lg-2" var="subNavigationClass"/>
							<c:set value="col-md-12" var="subNavigationItemClass"/>
						</c:when>
	
						<c:when test="${totalSubNavigationColumns == 2}">
							<c:set value="col-md-6 col-lg-4" var="subNavigationClass"/>
							<c:set value="col-md-6" var="subNavigationItemClass"/>
						</c:when>
						
						<c:when test="${totalSubNavigationColumns == 3}">
							<c:set value="col-md-9 col-lg-6" var="subNavigationClass"/>
							<c:set value="col-md-4" var="subNavigationItemClass"/>
						</c:when>
	
						<c:when test="${totalSubNavigationColumns == 4}">
							<c:set value="col-md-12 col-lg-8" var="subNavigationClass"/>
							<c:set value="col-md-3" var="subNavigationItemClass"/>
						</c:when>
	
						<c:when test="${totalSubNavigationColumns == 5}">
							<c:set value="col-md-12" var="subNavigationClass"/>
							<%--custom grid class required because 1/5th columns aren't supported by bootstrap--%>
							<c:set value="column-20-percent" var="subNavigationItemClass"/>
						</c:when>
	
						<c:when test="${totalSubNavigationColumns > 5}">
							<c:set value="col-md-12" var="subNavigationClass"/>
							<c:set value="col-md-2" var="subNavigationItemClass"/>
						</c:when>
					</c:choose>
					<%-- Decide which class to use -- End --%>
					
					<%-- Iterate over all 1 level children --%>
					<c:if test="${not empty childLevel1.children}">
						
						<span class="glyphicon  glyphicon-chevron-left hidden-md hidden-lg nav__link--drill__down js_nav__link--drill__down" style="display:none;" onclick="$(this).next().show(); $(this).next().next().hide(); $('.row2Max').remove(); $(this).hide();"></span>
						<span class="glyphicon  glyphicon-chevron-right hidden-md hidden-lg nav__link--drill__down js_nav__link--drill__down" onclick="$(this).prev().show(); $(this).next().show(); $('.row2Max').remove(); $(this).hide();"></span>
						
						
						
						<c:choose>
							<c:when test="${hasSubChild}">
							
								<div class="row2" style="display:none">
									<c:forEach items="${childLevel1.children}" var="childLevel2"> 
										<c:if test="${not empty childLevel2.title}">
											<c:forEach items="${childLevel2.entries}" var="childlink2">
												<div>
													<cms:component component="${childlink2.item}" evaluateRestriction="true" element="span" class="yCmsComponent link2Level nav__link js_nav__link"/>
													<c:if test="${not empty childLevel2.children}">
														
														<span class="glyphicon  glyphicon-chevron-left hidden-md hidden-lg nav__link--drill__down js_nav__link--drill__down" style="float:right; width:auto; display:none;" onclick="$(this).next().show(); $(this).next().next().hide(); $(this).hide();"></span>
														<span class="glyphicon  glyphicon-chevron-right hidden-md hidden-lg nav__link--drill__down js_nav__link--drill__down" style="float:right; width:auto;" onclick="$(this).prev().show(); $(this).next().show(); $(this).hide();"></span>
	
														<div class="row3" style="display:none">
															
															<c:forEach items="${childLevel2.children}" var="childLevel3">
																<c:forEach items="${childLevel3.entries}" var="childlink3">
																	
																		<cms:component component="${childlink3.item}" evaluateRestriction="true" element="div" class="link3Level" />
																	
																</c:forEach>
															</c:forEach>
															
														
														</div>
	
													</c:if>												

												</div>	

												
											</c:forEach>
										</c:if>
									</c:forEach>
								</div>
								
								
								<ul class="row2Max">
									<c:forEach items="${childLevel1.children}" var="childLevel2"> 
										<c:if test="${not empty childLevel2.title}">
											<c:forEach items="${childLevel2.entries}" var="childlink2">
												<li>
													<cms:component component="${childlink2.item}" evaluateRestriction="true" element="div" class="navNodeSubLevel" />	
													<c:if test="${not empty childLevel2.children}">
														<ul class="sub-navigation-list has-title col-md-2" style="white-space: nowrap;">
															<c:forEach items="${childLevel2.children}" var="childLevel3">
																<c:forEach items="${childLevel3.entries}" var="childlink3">
																	<li>
																		<cms:component component="${childlink3.item}" evaluateRestriction="true" element="div" class="navNodeSubLevel" />
																	</li>
																</c:forEach>
															</c:forEach>
														</ul>
													</c:if>
													
												</li>
											</c:forEach>
										</c:if>
									</c:forEach>
								</ul>								
							
						
						    </c:when>    
						</c:choose>
					</c:if>
					
					
				</li>
			
			
			
			
			</c:forEach>

		</ul>







		</div>
	</nav>
</c:if>